# 真實世界逐字稿問題分析

**重要認知修正**:
- ❌ 錯誤假設: BSS.txt 是「標準格式」
- ✅ 真實情況: BSS.txt 已經過人工整理，真實逐字稿更混亂

---

## 一、真實 Teams 逐字稿的實際狀況

### 1.1 真實輸出格式

**Teams 實際輸出**:
```
Speaker 0  0:04
剛剛就是可到底啊在講話啦。

Speaker 1  0:06
剛剛是Brenda。

Speaker 2  0:07
沒有*是Brenda。

Speaker 0  0:09
好是blinda哇，這喔。

Speaker 2  0:10
對我的聲音，你還認不出來。
```

**問題**:
1. ❌ 沒有人名，只有 `Speaker 0`, `Speaker 1`, `Speaker 2`
2. ❌ Speaker 編號經常**錯亂** (同一人可能變號)
3. ❌ 辨識錯誤 (Brenda → blinda)
4. ❌ 台語、口語詞誤判 (「可到底」是什麼？)

---

### 1.2 Speaker 編號錯亂實例

**真實案例追蹤**:
```
0:04  Speaker 0: "剛剧就是可到底啊在講話啦"
      → 實際: 蔡宗哲

0:06  Speaker 1: "剛剛是Brenda"
      → 實際: 林以凡

0:07  Speaker 2: "沒有*是Brenda"
      → 實際: Brenda Tsai

0:09  Speaker 0: "好是blinda哇"
      → 實際: 蔡宗哲 (同一人，編號一致)

5:33  Speaker 0: "經濟銀行這邊沒有問題啦嗯？"
      → 實際: Scott Chen ❌ (Speaker 0 換人了！)
```

**結論**: Speaker 編號在會議中途**重新分配** ❌

---

### 1.3 語音辨識錯誤

**常見錯誤類型**:

| 原始語音 | Teams 辨識 | 正確內容 |
|---------|-----------|---------|
| "Wallace" | "哇is" / "挖is" | Wallace |
| "Brenda" | "blinda" / "不會讓" | Brenda |
| "Chris" | "克里斯" / "Chris" | Chris |
| "碩文拓" | "宋文拓" / "作文託" / "托" | 碩文拓 |
| "可到底" | ？？ | (口語詞，無法確定) |
| "齁" | "吼" / "喔" | 齁 (語氣詞) |

---

## 二、人名格式爭議的真相

### 2.1 我的錯誤假設

**我的假設**:
```
Pipeline 應該保留「蔡宗哲 (Tom Tsai)」完整格式
```

**問題**:
1. 真實逐字稿根本沒有人名，只有 `Speaker N`
2. 即使 Teams 認出 "Tom"，也會寫成 `Speaker 0`
3. 人名對應是**人工後製**，不是自動的

---

### 2.2 真實場景下的人名識別

**實際工作流程**:

```
步驟 1: Teams 輸出
-------
Speaker 0  5:33
經濟銀行這邊沒有問題啦嗯？

步驟 2: 人工識別 (必要)
-------
- 聽聲音: 這是 Scott
- 查上下文: 前面在討論一銀，Scott 負責 753
- 確認身份: Speaker 0 (此時) = Scott Chen

步驟 3: 手動標註
-------
Scott Chen (陳志光)  5:33
經濟銀行這邊沒有問題啦嗯？

步驟 4: Pipeline 處理
-------
輸入: "Scott Chen (陳志光): 經濟銀行這邊沒有問題"
Gemma3 摘要: "Scott Chen 確認經濟銀行狀況良好"
```

**關鍵問題**:
- 如果步驟 3 (手動標註) 沒做，Pipeline 收到的是 `Speaker 0`
- Pipeline 無法知道 `Speaker 0` 是誰

---

### 2.3 為什麼 BSS.txt 有完整人名？

**答案**: **人工整理過** ✅

```
原始 Teams 輸出:
Speaker 2  3:10
各位好，請問一下有看到我的畫面嗎？

人工整理後 (BSS.txt):
Brenda Tsai (蔡素貞)  3:10
各位好，請問一下有看到我的畫面嗎？
```

**整理工作量**:
- 52 分鐘會議
- 830 行對話
- 9 個說話者
- 識別 + 標註時間: **至少 2-3 小時**

---

## 三、真正的核心問題重新定義

### 3.1 問題不是「保留人名格式」

**錯誤焦點**:
```
❌ Pipeline 把 "蔡宗哲 (Tom Tsai)" 簡化成 "蔡宗哲"
```

**真正問題**:
```
✅ 真實逐字稿只有 "Speaker 0"，Pipeline 能否自動識別是誰？
```

---

### 3.2 真正的挑戰

| 挑戰 | 說明 | 目前解決方案 |
|-----|------|------------|
| **Speaker 識別** | Speaker 0 是誰？ | ❌ 需人工標註 |
| **Speaker 換號** | Speaker 0 中途換人 | ❌ 無法自動偵測 |
| **語音辨識錯誤** | "哇is" = Wallace | ⚠️ 可用 LLM 修正 |
| **口語詞處理** | "齁"、"欸" | ⚠️ 可保留或刪除 |
| **責任歸屬** | 誰負責追蹤？ | ⚠️ 需從對話推斷 |

---

## 四、Pipeline vs Claude 在真實場景的對比

### 4.1 輸入真實逐字稿時

**情境**: 直接餵 Teams 原始輸出 (Speaker 0/1/2...)

#### Claude 處理

```python
# 輸入 Claude
input_text = """
Speaker 0  3:10
各位好，請問一下有看到我的畫面嗎？

Speaker 1  3:13
No。

Speaker 0  3:15
謝謝，那我這邊就報告有關卓越跟宋文拓這兩呃，
這三週的訂單統計還有收款發票的部分。
這呃，這三週的卓越有242萬的訂單...
"""

# Claude 輸出
output = """
**財務報告** (Speaker 0):
- 卓越三週訂單: 242萬
- 宋文拓三週訂單: 7.9萬
...
"""
```

**Claude 的處理**:
- ✅ 保留 `Speaker 0` 標籤
- ✅ 可從內容推斷角色 (報告財務 → 可能是財務長)
- ❌ 但無法知道真實姓名

---

#### Pipeline 處理

```python
# 步驟 1: 1topic_spliterG3v2.py
chunks = split_by_topic(transcript)
# 輸出: Speaker 0 報告財務 → 主題 "財務收款"

# 步驟 2: 2chunks_summary.py
summary = generate_summary(chunk)
# 輸出: "財務報告：卓越242萬，宋文拓7.9萬"
# ❌ 連 "Speaker 0" 都丟失了

# 步驟 5: pipeline_meeting_report.py
final = generate_report(summaries)
# 輸出: "卓越三週訂單242萬"
# ❌ 完全無說話者資訊
```

**Pipeline 的處理**:
- ❌ 在步驟 2 就丟失 `Speaker 0`
- ❌ 最終報告無任何說話者標記
- ❌ 無法追蹤責任歸屬

---

### 4.2 關鍵差異

| 項目 | Claude | Pipeline | 差距 |
|-----|--------|----------|------|
| **保留 Speaker N** | ✅ 保留 | ❌ 丟失 | Claude 勝 |
| **推斷角色** | ✅ 可推斷 | ❌ 無法推斷 | Claude 勝 |
| **識別真實姓名** | ❌ 需人工 | ❌ 需人工 | 平手 |
| **處理速度** | 20-30 min | <1 min | Pipeline 勝 |
| **本地保密** | ❌ 上傳雲端 | ✅ 完全本地 | Pipeline 勝 |

---

## 五、真實場景的實際需求

### 5.1 用戶真正需要什麼？

**場景 A: 保密會議 (董事會)**
```
需求:
1. ✅ 完全本地處理 (零外傳)
2. ⚠️ Speaker 0/1/2 可接受 (內部人知道是誰)
3. ✅ 數字準確
4. ✅ 決策記錄完整

選擇: Pipeline + 人工對照 Speaker 表
```

**場景 B: 一般會議 (可上雲)**
```
需求:
1. ✅ 自動識別人名
2. ✅ 責任歸屬清晰
3. ✅ 完整決策邏輯

選擇: Claude (接受上傳風險)
```

**場景 C: 日常會議 (低機密)**
```
需求:
1. ✅ 快速產出
2. ⚠️ 人名不重要 (內部人都知道)
3. ✅ 重點摘要即可

選擇: Pipeline (Speaker N 版本)
```

---

### 5.2 「人名格式」爭議的本質

**我的錯誤**:
```
我糾結於: "蔡宗哲 (Tom Tsai)" vs "蔡宗哲"
```

**真實問題**:
```
實際糾結: "Speaker 0" vs "無說話者" vs "蔡宗哲"

現實:
- 真實逐字稿: Speaker 0 ← 這才是起點
- 人工整理: Speaker 0 → 蔡宗哲 (Tom Tsai) ← 需 2-3 小時
- Pipeline: Speaker 0 → 無 ← 丟失
- Claude: Speaker 0 → Speaker 0 ← 保留
```

---

## 六、Pipeline 的真正修復方向

### 6.1 保留 Speaker 標籤 (Critical)

**修改 2chunks_summary.py**:
```python
SYSTEM_PROMPT = """你是專業的會議記錄員。

【說話者標籤要求】（最高優先級）：
- ✅ 必須保留 Speaker 標籤
- ✅ 格式: "Speaker N: 內容"
- ❌ 禁止: 省略說話者標籤

【範例】：
正確: Speaker 0 建議與消防協會簽MOU
錯誤: 建議與消防協會簽MOU ← 不知道誰說的

【原因】：Speaker 標籤是唯一的責任追蹤依據
"""
```

**預期效果**:
```
修改前: "建議與消防協會簽MOU" ← 誰說的？❌
修改後: "Speaker 3 建議與消防協會簽MOU" ← 可追蹤 ✅
```

---

### 6.2 語音辨識錯誤修正 (Nice to Have)

**可選方案: 用 LLM 修正常見錯誤**

```python
def fix_transcription_errors(text):
    """修正 Teams 常見辨識錯誤"""

    replacements = {
        '哇is': 'Wallace',
        '挖is': 'Wallace',
        '不會讓': 'Brenda',
        'blinda': 'Brenda',
        '宋文拓': '碩文拓',
        '作文託': '碩文拓',
        '托': '碩文拓',
    }

    for wrong, correct in replacements.items():
        text = text.replace(wrong, correct)

    return text
```

**限制**:
- 需手動維護錯誤表
- 可能誤修正其他內容

---

### 6.3 Speaker 對照表生成 (半自動)

**方案**: 從會議內容推斷 Speaker 身份

```python
def infer_speaker_identity(transcript):
    """從內容推斷 Speaker 身份"""

    # 財務報告 → 可能是 CFO
    if 'Speaker 0' 提到 "發票"、"收款"、"財務報表":
        likely_speakers[0] = "CFO (財務長)"

    # BSR 專案 → 可能是 Wallace
    if 'Speaker 1' 提到 "BSR"、"花蓮港"、"中鋼":
        likely_speakers[1] = "Wallace (BSR負責人)"

    # 生成對照表
    return {
        'Speaker 0': 'Brenda (推測: 財務長)',
        'Speaker 1': 'Wallace (推測: BSR負責人)',
        ...
    }
```

**輸出**:
```markdown
## Speaker 對照表 (AI 推測)

| Speaker | 推測身份 | 推測依據 |
|---------|---------|---------|
| Speaker 0 | Brenda (財務長) | 報告發票、收款、財務報表 |
| Speaker 1 | Wallace (BSR) | 報告 BSR 專案、花蓮港 |
| Speaker 2 | Scott (753) | 報告 753 專案、消防局 |

⚠️ 此為 AI 推測，請人工確認
```

---

## 七、重新評估三方案

### 7.1 真實輸入場景對比

#### 場景 1: Teams 原始輸出 (Speaker N)

| 方案 | 人名識別 | 責任追蹤 | 數字準確 | 速度 | 保密 |
|-----|---------|---------|---------|------|------|
| **Claude** | Speaker N 保留 ✅ | 可從內容推斷 ⚠️ | 100% ✅ | 慢 ⚠️ | ❌ 上雲 |
| **Pipeline** | ❌ 丟失 | ❌ 無法追蹤 | 77% ⚠️ | 快 ✅ | ✅ 本地 |
| **Sam 風格** | ❌ 丟失 | ❌ 無法追蹤 | 97% ✅ | 快 ✅ | ❌ 上雲 |

**結論**: Claude 勝 (保留 Speaker N)

---

#### 場景 2: 人工標註後 (真實姓名)

| 方案 | 人名格式 | 責任追蹤 | 數字準確 | 速度 | 保密 |
|-----|---------|---------|---------|------|------|
| **Claude** | 完整 ✅ | 100% ✅ | 100% ✅ | 慢 ⚠️ | ❌ 上雲 |
| **Pipeline** | 簡化 ⚠️ | 模糊 ⚠️ | 77% ⚠️ | 快 ✅ | ✅ 本地 |
| **Sam 風格** | 完整 ✅ | 模糊 ⚠️ | 97% ✅ | 快 ✅ | ❌ 上雲 |

**結論**: Claude 勝 (但 Pipeline 本地保密優勢明顯)

---

### 7.2 修正後的 Pipeline 評分

**原評分** (假設人工標註):
- 人名完整性: 0/20 (簡化為單一語言)

**真實場景評分** (Teams 原始輸出):
- Speaker 保留: 0/20 ❌ (完全丟失)
- Speaker 推斷: 0/10 ❌ (無法從內容推斷)

**修復後預期**:
- Speaker 保留: 18/20 ✅ (強制保留標籤)
- Speaker 推斷: 5/10 ⚠️ (半自動對照表)

---

## 八、最終建議 (真實場景版)

### 8.1 保密會議 (董事會/國防)

**推薦**: Pipeline + Speaker 對照表

```
步驟 1: Teams 輸出 (Speaker N)
步驟 2: Pipeline 處理 (保留 Speaker N)
步驟 3: 人工對照表
-------
Speaker 0 = 董事長
Speaker 1 = 財務長
Speaker 2 = 法務長
```

**優點**:
- ✅ 完全本地 (零外傳)
- ✅ Speaker N 已足夠 (內部人知道)
- ✅ 速度快 (<1 min)

**代價**:
- ⚠️ 需人工對照表 (5-10 min)

---

### 8.2 一般商業會議

**推薦**: Claude

```
步驟 1: Teams 輸出 (Speaker N)
步驟 2: 餵給 Claude
步驟 3: Claude 輸出 (保留 Speaker N + 內容推斷)
```

**優點**:
- ✅ 保留 Speaker N
- ✅ 可從內容推斷角色
- ✅ 完整決策邏輯

**代價**:
- ❌ 資料上傳雲端
- ⚠️ 速度較慢 (20-30 min)

---

### 8.3 日常例會 (低機密)

**推薦**: Pipeline 快速版

```
步驟 1: Teams 輸出
步驟 2: Pipeline 處理
步驟 3: 產出摘要 (不標註說話者)
```

**優點**:
- ✅ 極快 (<1 min)
- ✅ 本地處理
- ⚠️ 不需說話者 (內部人都知道在討論什麼)

**適用**: 日常 Standup、週會

---

## 九、結論

### 9.1 我的錯誤認知

**錯誤 1**: 以為人名格式是 "蔡宗哲 (Tom Tsai)" vs "蔡宗哲" 的問題
**真相**: 真實逐字稿只有 "Speaker N"，連基本人名都沒有

**錯誤 2**: 以為 Pipeline 應該保留完整人名格式
**真相**: Pipeline 應該先解決「保留 Speaker N 標籤」的問題

**錯誤 3**: 以為 BSS.txt 是標準格式
**真相**: BSS.txt 是人工整理 2-3 小時的結果

---

### 9.2 真正的核心問題

1. **Teams 輸出混亂**:
   - Speaker N 編號會換
   - 語音辨識錯誤
   - 無人名資訊

2. **Pipeline 丟失 Speaker**:
   - 步驟 2 就丟失說話者
   - 無法追蹤責任歸屬

3. **人工整理成本高**:
   - 52 分鐘會議 → 2-3 小時整理
   - 不可能每次都做

---

### 9.3 修復優先級 (重新定義)

| 優先級 | 問題 | 修復方案 | 預期效果 |
|--------|------|---------|---------|
| 🔴 **P0** | Speaker 標籤丟失 | 強制保留 Speaker N | 可追蹤責任 |
| 🟡 **P1** | 月度明細合併 | Prompt 強制逐月 | 財務可規劃 |
| 🟡 **P1** | 語音辨識錯誤 | 錯誤表修正 | 提高可讀性 |
| 🔵 **P2** | Speaker 身份推斷 | 半自動對照表 | 減少人工 |
| 🟢 **P3** | 人名格式 | (不重要) | - |

---

**報告完成時間**: 2025-12-01
**重要認知**: 別糾結人名格式，真實世界連 "Speaker N" 都沒保留好
